{% extends 'base.html' %} 
{% from "includes/_macros.html" import delBtn, addRowBtn, comboBox %}

{% block title %} {{title}} {% endblock %} 

{% block css %} 
{% endblock %} 

{% macro header(text) %}
  <h1 >{{text}}</h1>
{% endmacro %}

{% block content %}

{{header("Edit users")}}   

{{addRowBtn()}}

<div class="row">
  <form action="{{ url_for('save_users') }}" method="POST" enctype="multipart/form-data">
    <div class="col-md-12">
      <table class="table table-bordered" id="editableTable">
        <thead>
          <tr class="bg-secondary text-light">
            <th width="6%">sn</th>            
            <th>Name</th>
            <th>Username</th>
            <th>Password</th>
            <th>Email</th>
            <th>User Type</th>            
            <th>Sch.</th>
            <th>Year</th>
            <th>Picture</th>
            <th>Notes</th>
            <th width="2%">Delete</th>
          </tr>
        </thead>
        <tbody>
          {% if usersData %}
          {% for row in usersData %}
          <tr>
            <td>
              <input class="form-control" type="text" id="sn" readonly="true" value="{{row.row_num}}">
            </td>
            <td>
              <input type="hidden" name="id" value="{{row.id}}">
              <input class="form-control" type="text" name="name" id="name" value="{{row.name}}" required>
            </td>
            <td>
              <input class="form-control" type="text" name="username" id="username" value="{{row.username}}" required>
            </td>
            <td>
              <input class="form-control" type="password" name="password" id="password" value="{{row.pwd}}" required>
            </td>
            <td>
              <input class="form-control" type="email" name="email" id="email" value="{{row.email}}">
            </td>
            <td>
              {{comboBox('usertype', userTypeCombo, row.usertype)}}
            </td>
            <td>
              {{comboBox('sch', schCombo, row.sch_id)}}
            </td>  
            <td>
              {{comboBox('year', yearsCombo, row.year)}}
            </td>                       
            <td>
              <input class="form-control" id="fileupload" name="picture" type="file" value="{{row.picture}}" />
            </td> 
            <td>
              <input class="form-control" type="text" name="notes" id="notes" value="{{row.notes}}">
            </td>                         
            <td style="text-align: center;">
              <a class="button button-small edit" href="{{url_for('del_user', userID=row.id)}}" title="Delete"
                onclick="delRecord(this)">
                <i class="fa fa-trash fa-lg"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td>
              <input class="form-control" type="text" id="sn" readonly="true" value="">
            </td>
            <td>
              <input type="hidden" name="id" value="">
              <input class="form-control" type="text" name="name" id="name" value="" required>
            </td>
            <td>
              <input class="form-control" type="text" name="username" id="username" value="" required>
            </td>
            <td>
              <input class="form-control" type="password" name="password" id="password" value="" required>
            </td>
            <td>
              <input class="form-control" type="email" name="email" id="email" value="" required>
            </td>
            <td>
              {{comboBox('usertype', userTypeCombo, '')}}
            </td>
            <td>
              {{comboBox('sch', schCombo, '')}}
            </td>   
            <td>
              {{comboBox('year', yearsCombo, '')}}
            </td>                        
            <td>
              <input class="form-control" id="fileupload" name="picture" type="file" value="" />
            </td>  
            <td>
              <input class="form-control" type="text" name="notes" id="notes" value="{{row.notes}}">
            </td>                         
            {{delBtn("")}}
          </tr>                            
          {% endif %}
        </tbody>
      </table>
      <button type="submit" class="btn btn-primary" id="saveBtn">Save</button>
  </form>
</div>

</div>
{% endblock %}

{% block javascript %}
<script src="{{url_for('static', filename='js/jquery-3.6.0.min.js')}}"></script>
<script>
// Add New Record
const addRowBtn = document.querySelector(".add-row");
addRowBtn.addEventListener('click', addNewRecord);
function addNewRecord() {
  let sn = document.querySelectorAll('#sn');  
  const table = document.querySelector("#editableTable");
  
  $("#editableTable").find("tbody tr:last").after(`<tr> <td> <input class="form-control" type="text" id="sn" readonly="true" value="${sn.length+1}"> </td><td> <input type="hidden" name="id" value=""> <input class="form-control" type="text" name="code" id="code" value="" required=""> </td><td> <input class="form-control" type="text" name="name" id="name" value="" required=""> </td><td> <select class="form-select form-select" name="major" id="major"><option value="1" selected="">Computer Science</option>  </select> </td><td> <select class="form-select form-select" name="year" id="year"> <option value="1" selected="">Freshmen</option> </select></td><td> <input class="form-control" id="fileupload" name="picture" type="file" value=""> </td><td> <select class="form-select form-select" name="user" id="user"><option value="4">menna</option></select> </td><td style="text-align: center;"> <a class="button button-small edit" href="" title="Delete" onclick="delRecord(this)"> <i class="fa fa-trash fa-lg"></i> </a> </td></tr>`);
  
  // async function fillCombo(){
  //   const response = await fetch();
  // }
}  
</script>
{% endblock %}